<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Lucky Draw</title>

<style>
/* ---------------- base ---------------- */
body {
  margin: 0;
  background: #c2dff5;
  font-family: "futura", "pretendard", "helvetica";
  color: #111;
  overflow-x: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  -webkit-tap-highlight-color: transparent;
}

/* ---------------- fixed UI ---------------- */
.logo {
  position: fixed;
  top: 30px;
  right: 30px;
  z-index: 10;
}
.logo img { width: 80px; }

.back {
  position: fixed;
  top: 30px;
  left: 30px;
  font-size: 12px;
  text-decoration: none;
  color: inherit;
  opacity: 0.7;
  border: 1px solid #111;
  border-radius: 999px;
  padding: 6px 14px;
  z-index: 10;
}

.back:hover {
      opacity: 1;
      background: rgba(0,0,0,0.05);
    }  

 /* ---------------- page content ---------------- */

    .page-wrap {
      max-width: 420px;
      margin: 0 auto;
      padding-top: 0px;
      text-align: center;
      
    }

    .Title {
      font-family: futura;
      font-size: clamp(20px, 3.5vw, 25px);
      margin: -40 0 10px;
      opacity: 0.85;
    }
  

/* ---------------- draw area ---------------- */
.draw-area {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.draw-trigger {
  touch-action: manipulation;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.draw-trigger img {
  width: 100%;
  max-width: 900px;
  margin-bottom: 20px;
}

.draw-trigger.shake img {
  animation: boxShake .45s ease;
}
@keyframes boxShake {
  0% { transform: rotate(0); }
  20% { transform: rotate(-3deg); }
  40% { transform: rotate(3deg); }
  60% { transform: rotate(-2deg); }
  80% { transform: rotate(2deg); }
  100% { transform: rotate(0); }
}

/* ---------------- stepper ---------------- */
.draw-stepper {
  display: flex;
  align-items: center;
  background: #fff;
  border: 2px solid #92d2ff;
  border-radius: 30px;
  padding: 10px 14px;
  gap: 14px;
}

.draw-stepper input {
  width: 50px;
  text-align: center;
  font-size: 20px;
  font-weight: 600;
  border: none;
  background: transparent;
}

.step-btn {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  border: none;
  background: #92d2ff;
  color: #fff;
  cursor: pointer;
}

/* ---------------- action buttons ---------------- */
.action-btn {
  margin-top: 16px;
  font-size: 13px;
  color: #92d2ff;
  border: 1px solid #92d2ff;
  border-radius: 999px;
  padding: 7px 18px;
  background: none;
  cursor: pointer;
}

#remainMain {
  margin-top: 12px;
  font-size: 12px;
  line-height: 1.6;
  white-space: pre-line;
  display: none;
}

/* ---------------- popup ---------------- */
.popup {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.45);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 20;
}

/* ---------------- letter ---------------- */
.letter {
  width: 250px;
  padding: 34px 28px 30px;
  text-align: center;
  border-radius: 6px;
  box-shadow: 0 14px 32px rgba(0,0,0,.18);
  animation: paperOpen .6s cubic-bezier(.22,1.1,.36,1);
}

@keyframes paperOpen {
  0% { transform: scaleY(.6) rotateX(-25deg); opacity: 0; }
  100% { transform: scaleY(1) rotateX(0); }
}

.letter.티셔츠 { background:#ffe969; }
.letter.타월슬로건 { background:#ffad7d; }
.letter.pvc파우치 { background:#92d2ff; }
.letter.쿠션키링 { background:#b9e2be; }
.letter.핀뱃지 { background:#ff9cb5; }
.letter.엽서세트 { background:#cbc4fe; }
.letter.스티커 { background:#f0ede8; }

.letter-visual-wrap {
  position: relative;
  margin: 16px 0;
}

.letter-visual {
  width: 100%;
}

/* ---------------- result text ---------------- */
.grade-wrap {
  position: absolute;
  top: 20%;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  pointer-events: none;
}

.grade {
  font-size: 13px;
  font-weight: 600;
  line-height: 1.6;
  text-align: center;
}

.grade.split {
  display: flex;
  justify-content: center;
  gap: 16px;
}

.result-group {
  width: 50%;
}

.highlight {
  color: #5bb6f0;
  font-weight: 600;
  text-shadow: 0 0 6px rgba(91,182,240,.25);
}

.popup-btn {
  margin-top: 26px;
  font-size: 12px;
  border-radius: 999px;
  border: 1px solid #111;
  padding: 6px 18px;
  background: none;
  cursor: pointer;
}
</style>
</head>

<body>
  
<a href="index.html" class="back">Back</a>
<!-- page content -->
<div class="page-wrap">
    <p class="Title">(so)lucky! draw</p>

<div class="logo">
  <img src="https://buly.kr/FhPFVd6">
</div>

<div class="draw-area">
  <div class="draw-trigger" id="drawBtn">
    <img src="https://buly.kr/90cSIXz">
    <div class="draw-stepper">
      <button class="step-btn" onclick="changeCount(-1,event)">◀</button>
      <input type="text" id="drawCount" value="1" readonly>
      <button class="step-btn" onclick="changeCount(1,event)">▶</button>
    </div>
  </div>

  <!-- ✅ 되살아난 버튼들 -->
  <button class="action-btn" id="remainBtn">남은 수량 보기</button>
  <div id="remainMain"></div>

  <button class="action-btn" id="resetBtn">RESET</button>
</div>

<div class="popup" id="popup">
  <div class="letter">
    <div class="letter-visual-wrap">
      <img class="letter-visual" src="https://buly.kr/G3ElTFD">
      <div class="grade-wrap">
        <div class="grade" id="result"></div>
      </div>
    </div>
    <button class="popup-btn" onclick="closePopup()">OK</button>
  </div>
</div>

<script>
const STORAGE_KEY = 'luckyDrawPool';
const highlightItems = ['티셔츠','타월슬로건','pvc파우치'];

function createInitialPool(){
  return [
    ...Array(3).fill('티셔츠'),
    ...Array(5).fill('타월슬로건'),
    ...Array(16).fill('pvc파우치'),
    ...Array(36).fill('쿠션키링'),
    ...Array(50).fill('핀뱃지'),
    ...Array(50).fill('엽서세트'),
    ...Array(150).fill('스티커')
  ];
}

let prizePool = JSON.parse(localStorage.getItem(STORAGE_KEY));
if(!prizePool){
  prizePool = createInitialPool();
  shuffle(prizePool);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(prizePool));
}

const drawBtn = document.getElementById('drawBtn');
const popup = document.getElementById('popup');
const result = document.getElementById('result');
const letter = document.querySelector('.letter');
const sound = document.getElementById('rustleSound');
const remainBtn = document.getElementById('remainBtn');
const remainMain = document.getElementById('remainMain');
const resetBtn = document.getElementById('resetBtn');

let canDraw = true;

drawBtn.onclick = () => {
  if(!canDraw) return;
  canDraw = false;

  // ✅ Safari 확실히 나는 방식
  const sound = new Audio('https://cdn.pixabay.com/audio/2022/03/15/audio_0c9b0d66d8.mp3');
  sound.volume = 1;
  sound.play();

  drawBtn.classList.add('shake');
  setTimeout(()=>drawBtn.classList.remove('shake'),450);

  setTimeout(()=>{
    const count = parseInt(drawCount.value,10);
    const drawn = prizePool.splice(-count);

    localStorage.setItem(STORAGE_KEY, JSON.stringify(prizePool));
    letter.className = `letter ${drawn[0]}`;

    const makeList = arr =>
      arr.map(p =>
        highlightItems.includes(p)
          ? `<span class="highlight">${p}</span>`
          : p
      ).join('<br>');

    if(drawn.length > 6){
      result.classList.add('split');
      const half = Math.ceil(drawn.length / 2);
      result.innerHTML = `
        <div class="result-group">${makeList(drawn.slice(0, half))}</div>
        <div class="result-group">${makeList(drawn.slice(half))}</div>
      `;
    } else {
      result.classList.remove('split');
      result.innerHTML = makeList(drawn);
    }

    popup.style.display = 'flex';
    setTimeout(()=>canDraw=true,5000);
  },350);
};

function closePopup(){
  popup.style.display = 'none';
}

remainBtn.onclick = () => {
  const map = {};
  prizePool.forEach(p => map[p] = (map[p] || 0) + 1);
  remainMain.textContent = Object.entries(map).map(([k,v])=>`${k} : ${v}`).join('\n');
  remainMain.style.display = remainMain.style.display === 'none' ? 'block' : 'none';
};

resetBtn.onclick = () => {
  if(confirm('정말 전체 수량을 초기화할까요?')){
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  }
};

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}

function changeCount(d,e){
  e.stopPropagation();
  let v=parseInt(drawCount.value,10)+d;
  if(v<1) v=1;
  drawCount.value=v;
}
</script>

</body>
</html>
